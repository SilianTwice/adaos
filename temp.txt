        self._snapshot_loaded = False
        self._snapshot_task: asyncio.Task | None = None
        self._snapshot_stop = False
        self._snapshot_interval = 20.0

    async def _open_db(self) -> aiosqlite.Connection:
        """
        Open SQLite connection with tuned pragmas.
        """
        await db.execute("PRAGMA journal_mode=MEMORY")
        await db.execute("PRAGMA synchronous=OFF")
        await db.execute("PRAGMA busy_timeout=5000")
        return db

    async def _init_db(self) -> None:  # type: ignore[override]
        async with self.lock:
            db = await self._open_db()
            try:
                if not self._snapshot_loaded:
                    await self._load_snapshot(db)
                await db.execute("CREATE TABLE IF NOT EXISTS yupdates (path TEXT NOT NULL, yupdate BLOB, metadata BLOB, timestamp REAL NOT NULL)")
                await db.execute("CREATE INDEX IF NOT EXISTS idx_yupdates_path_timestamp ON yupdates (path, timestamp)")
                await db.execute(f"PRAGMA user_version = {self.version}")
                await db.commit()
            finally:
                await db.close()
        self.db_initialized.set()
        self._ensure_snapshot_task()

